{
  "$defs": {
    "BaseResultDetail": {
      "properties": {},
      "title": "BaseResultDetail",
      "type": "object"
    },
    "MetaStructureEvalConfig": {
      "properties": {
        "random_seed": {
          "default": 42,
          "description": "Random seed used when training the meta-structure model.",
          "title": "Random Seed",
          "type": "integer"
        },
        "width_ratio": {
          "default": 0.25,
          "description": "Meta-SAE width as a fraction of the base SAE width (d_sae * width_ratio).",
          "title": "Meta-SAE Width Ratio",
          "type": "number"
        },
        "k": {
          "default": 4,
          "description": "Average number of active latents to maintain during meta-structure training.",
          "title": "BatchTopK k",
          "type": "integer"
        },
        "train_steps": {
          "default": 1500,
          "description": "Number of training steps to run when fitting the meta-structure model.",
          "title": "Training Steps",
          "type": "integer"
        },
        "train_batch_size": {
          "default": 1024,
          "description": "Number of decoder rows to use per meta-structure training batch.",
          "title": "Training Batch Size",
          "type": "integer"
        },
        "learning_rate": {
          "default": 0.0005,
          "description": "Learning rate for the meta-structure Adam optimizer.",
          "title": "Learning Rate",
          "type": "number"
        },
        "weight_decay": {
          "default": 0.0,
          "description": "Weight decay to apply while training the meta-structure model.",
          "title": "Weight Decay",
          "type": "number"
        },
        "autocast": {
          "default": true,
          "description": "Whether to enable torch.autocast during meta-structure training.",
          "title": "Use Autocast",
          "type": "boolean"
        },
        "eval_batch_size": {
          "default": 4096,
          "description": "Batch size used to compute decoder variance explained.",
          "title": "Eval Batch Size",
          "type": "integer"
        },
        "dead_feature_window": {
          "default": 2000,
          "description": "Steps before a latent is considered dead for auxiliary losses.",
          "title": "Dead Feature Window",
          "type": "integer"
        },
        "feature_sampling_window": {
          "default": 200,
          "description": "Steps between sparsity statistics resets during training.",
          "title": "Feature Sampling Window",
          "type": "integer"
        },
        "dtype": {
          "default": "float32",
          "description": "Datatype to use for meta-structure training.",
          "title": "Meta-Structure DType",
          "type": "string"
        }
      },
      "title": "MetaStructureEvalConfig",
      "type": "object"
    },
    "MetaStructureMetricCategories": {
      "properties": {
        "meta_structure": {
          "$ref": "#/$defs/MetaStructureMetrics",
          "description": "Metrics for the meta-structure decoder variance evaluation.",
          "title": "Meta-Structure",
          "ui_default_display": true
        }
      },
      "required": [
        "meta_structure"
      ],
      "title": "MetaStructureMetricCategories",
      "type": "object"
    },
    "MetaStructureMetrics": {
      "properties": {
        "decoder_fraction_variance_explained": {
          "description": "Fraction of variance in the base SAE decoder reconstructed by the meta-structure model.",
          "title": "Decoder Fraction Variance Explained",
          "type": "number",
          "ui_default_display": true
        },
        "train_time_seconds": {
          "description": "Wall-clock seconds spent fitting the meta-structure model.",
          "title": "Training Time (s)",
          "type": "number"
        },
        "final_reconstruction_mse": {
          "description": "Mean squared reconstruction error on the decoder matrix after training.",
          "title": "Final Reconstruction MSE",
          "type": "number"
        }
      },
      "required": [
        "decoder_fraction_variance_explained",
        "train_time_seconds",
        "final_reconstruction_mse"
      ],
      "title": "MetaStructureMetrics",
      "type": "object"
    }
  },
  "description": "Evaluation measuring how well a BatchTopK meta-structure compresses the decoder matrix of a base SAE.",
  "properties": {
    "eval_type_id": {
      "default": "meta_structure_decoder_variance",
      "description": "The type of the evaluation",
      "title": "Eval Type ID",
      "type": "string"
    },
    "eval_config": {
      "$ref": "#/$defs/MetaStructureEvalConfig",
      "description": "The configuration of the evaluation.",
      "title": "Eval Config Type"
    },
    "eval_id": {
      "description": "A unique UUID identifying this specific eval run",
      "title": "ID",
      "type": "string"
    },
    "datetime_epoch_millis": {
      "description": "The datetime of the evaluation in epoch milliseconds",
      "title": "DateTime (epoch ms)",
      "type": "integer"
    },
    "eval_result_metrics": {
      "$ref": "#/$defs/MetaStructureMetricCategories",
      "description": "The metrics of the evaluation, organized by category. Define your own categories and the metrics that go inside them.",
      "title": "Result Metrics Categorized"
    },
    "eval_result_details": {
      "anyOf": [
        {
          "items": {
            "$ref": "#/$defs/BaseResultDetail"
          },
          "type": "array"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Eval Result Details"
    },
    "sae_bench_commit_hash": {
      "description": "The commit hash of the SAE Bench that ran the evaluation.",
      "title": "SAE Bench Commit Hash",
      "type": "string"
    },
    "sae_lens_id": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "description": "The ID of the SAE in SAE Lens.",
      "title": "SAE Lens ID"
    },
    "sae_lens_release_id": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "description": "The release ID of the SAE in SAE Lens.",
      "title": "SAE Lens Release ID"
    },
    "sae_lens_version": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "description": "The version of SAE Lens that ran the evaluation.",
      "title": "SAE Lens Version"
    },
    "sae_cfg_dict": {
      "anyOf": [
        {
          "additionalProperties": true,
          "type": "object"
        },
        {
          "type": "null"
        }
      ],
      "description": "The configuration of the SAE (custom or from SAE Lens) that ran the evaluation. This should match the SAE Lens config schema.",
      "title": "SAE Config Dict"
    },
    "eval_result_unstructured": {
      "anyOf": [
        {},
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Optional. Any additional outputs that don't fit into the structured eval_result_metrics or eval_result_details fields. Since these are unstructured, don't expect this to be easily renderable in UIs, or contain any titles or descriptions.",
      "title": "Unstructured Results"
    }
  },
  "required": [
    "eval_config",
    "eval_id",
    "datetime_epoch_millis",
    "eval_result_metrics",
    "sae_bench_commit_hash",
    "sae_lens_id",
    "sae_lens_release_id",
    "sae_lens_version",
    "sae_cfg_dict"
  ],
  "title": "Meta-Structure Decoder Variance",
  "type": "object"
}